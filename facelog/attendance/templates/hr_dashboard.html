{% extends 'base.html' %}

{% block start %}

<body class="vh-100 d-flex flex-column">



    <!-- Main Content (Sidebar + Detail View) -->
    <div class="container-fluid flex-grow-1 d-flex h-100">

        <!-- Left Sidebar -->
        <div class="col-md-3 bg-blue p-3 border-end overflow-auto" id="sidebar">
            <ul class="list-group">
                <li class="list-group-item list-group-item-action" onclick="showContent('Attendance')">Attendance</li>
                <li class="list-group-item list-group-item-action"  onclick="showContent('Employee')">Employees</li>
                <li class="list-group-item list-group-item-action">
                <a class="text-decoration-none text-dark" href="{% url 'add_employee' %}">Add Employee</a>
                </li>


            </ul>
        </div>

        <!-- Right Side (Detail Page) -->
        <div class="col-md-9 p-4 bg-light" id="content-area">
            <h3>Welcome to great moves!</h3>

        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript for Dynamic Content Update -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        fetchEmployees(); // Fetch employees on page load
    });

    function fetchEmployees() {
        fetch('/add-employee/') // Fetch data from Django API
        .then(response => response.json())
        .then(data => {
            let tableBody = document.getElementById("employeeTableBody");
            tableBody.innerHTML = ""; // Clear existing data

            data.forEach(employee => {
                let row = `
                    <tr>
                        <td>${employee.name}</td>
                        <td>${employee.emp_id}</td>
                        <td>${employee.designation}</td>
                        <td>${employee.image}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="editEmployee(${employee.emp_id})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.emp_id}, this)">Delete</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        })
        .catch(error => console.error("Error fetching employees:", error));
    }

    function editEmployee(empId) {
        alert("Edit Employee ID: " + empId);
    }

    function deleteEmployee(empId, button) {
        if (confirm("Are you sure you want to delete this employee?")) {
            fetch(`/add-employee/${empId}/`, { method: 'DELETE' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    button.parentNode.parentNode.remove(); // Remove row on success
                }
            })
            .catch(error => console.error("Error deleting employee:", error));
        }
    }
</script>

</body>

</html>

{% endblock %}