{% extends 'base.html' %}

{% block start %}

<body class="vh-100 d-flex flex-column">
    <div class="container-fluid flex-grow-1 d-flex h-100">
        <!-- Left Sidebar -->
        <div class="col-md-3 bg-blue p-3 border-end overflow-auto" id="sidebar">
            <ul class="list-group">
                <li class="list-group-item list-group-item-action" onclick="showContent('Attendance')">Attendance</li>
                <li class="list-group-item list-group-item-action" onclick="showContent('Employees')">Employees</li>
                <li class="list-group-item list-group-item-action" onclick="showContent('Add employee')">Add Employee
                </li>
            </ul>
        </div>

        <!-- Right Side (Detail Page) -->
        <div class="col-md-9 p-4 bg-light" id="content-area">
            <h3>Welcome to Great Moves!</h3>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        function showContent(option) {
            let contentArea = $("#content-area");
            contentArea.html("<h3>Loading...</h3>");

            if (option === "Attendance") {
                let tableHtml = `
                    <h3>Attendance Records</h3>
                    <label>Select Date:</label>
                    <input type="date" id="filterDate" class="form-control mb-2">
                    <button id="applyFilter" class="btn btn-primary mb-2">Apply</button>
                    
                    <table class="table table-bordered table-striped">
                        <thead class="thead-dark">
                            <tr>
                                <th>Employee ID</th>
                                <th>Employee Name</th>
                                <th>Date</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-body">
                            <tr><td colspan="4" class="text-center">No records found.</td></tr>
                        </tbody>
                    </table> 
                    
                    <a href="{% url 'download_attendance' %}" class="btn btn-success">
                        <i class="fas fa-download"></i> Download Attendance
                    </a>
                `;
                contentArea.html(tableHtml);

                $("#applyFilter").on("click", function () {
                    let selectedDate = $("#filterDate").val();
                    if (!selectedDate) {
                        alert("Please select a date!");
                        return;
                    }

                    contentArea.find("#attendance-body").html("<tr><td colspan='4' class='text-center'>Loading...</td></tr>");

                    $.getJSON(`/api/attendance_list/?date=${selectedDate}`, function (data) {
                        let newHtml = "";
                        if (data.attendances.length === 0) {
                            newHtml = `<tr><td colspan="4" class="text-center">No records found.</td></tr>`;
                        } else {
                            data.attendances.forEach(record => {
                                newHtml += `
                                    <tr>
                                        <td>${record.id}</td>
                                        <td>${record.name}</td>
                                        <td>${record.timestamp.split(" ")[0]}</td>
                                        <td>${record.timestamp.split(" ")[1]}</td>
                                    </tr>
                                `;
                            });
                        }
                        contentArea.find("#attendance-body").html(newHtml);
                    }).fail(function () {
                        contentArea.find("#attendance-body").html("<tr><td colspan='4' class='text-center text-danger'>Error loading attendance records!</td></tr>");
                    });
                });
            }
        }
    </script>
</body>
{% endblock %}